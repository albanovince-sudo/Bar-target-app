<!DOCTYPE html>
<html lang="it">
<head>
  <link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="icon.png">
  <link rel="apple-touch-icon" href="icon.png">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Obiettivo Mensile - Bar</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: Arial, sans-serif; background:#fff8f0; margin:0; padding:20px; }
  h1 { text-align:center; color:#ff6600; }
  .card { background:#fff; padding:15px; margin:15px 0; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
  input, button { padding:10px; margin:5px 0; font-size:16px; width:100%; }
  .progress-container { background:#eee; border-radius:20px; overflow:hidden; margin-top:10px; }
  .progress-bar { height:25px; background:#ff6600; width:0%; color:#fff; text-align:center; line-height:25px; transition:width .4s; }
</style>
<style>
  .admin-badge {font-size:12px;background:#eee;padding:6px 10px;border-radius:999px;margin-left:8px}
  .admin-btn {background:#f0f0f0;color:#222;border:0;padding:10px 12px;border-radius:10px;cursor:pointer}
  .admin-btn[disabled]{opacity:.5;pointer-events:none}
</style>
</head>
  <script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js').catch(console.error);
}
</script>
<body>

<h1>üìä Obiettivo Mensile</h1>

<div class="card">
  <label>Obiettivo mensile (‚Ç¨):</label>
  <input type="number" id="goal" value="30000">
  <button onclick="setGoal()">Imposta</button>
</div>

<div class="card">
  <label>Incasso giornaliero (‚Ç¨):</label>
  <input type="number" id="daily" placeholder="Es. 500">
  <button onclick="addDaily()">Aggiungi</button>
</div>

<div class="card">
  <h3>Totale Incassi: ‚Ç¨<span id="total">0</span></h3>
  <h3>Bonus 5%: ‚Ç¨<span id="bonus">0</span></h3>
  <div class="progress-container">
    <div id="progress" class="progress-bar">0%</div>
  </div>
</div>

<div class="card">
  <canvas id="chart" height="150"></canvas>
</div>

<script>
let goal = 30000;
let total = 0;
let days = [];
let amounts = [];

const ctx = document.getElementById('chart').getContext('2d');
let dailyChart = new Chart(ctx, {
  type:'bar',
  data:{ labels:[], datasets:[{label:'Incasso Giornaliero (‚Ç¨)', data:[], backgroundColor:'#ff6600'}]},
  options:{ responsive:true, scales:{ y:{ beginAtZero:true }}}
});

function setGoal(){
  goal = parseFloat(document.getElementById('goal').value);
  updateUI();
}

function addDaily(){
  let daily = parseFloat(document.getElementById('daily').value);
  if(!daily) return;
  let today = new Date().toLocaleDateString('it-IT');
  days.push(today);
  amounts.push(daily);
  total += daily;
  updateUI();
  document.getElementById('daily').value="";
}

function updateUI(){
  document.getElementById('total').innerText = total.toFixed(2);
  document.getElementById('bonus').innerText = (total*0.05).toFixed(2);
  let percent = Math.min((total/goal)*100,100);
  document.getElementById('progress').style.width = percent+"%";
  document.getElementById('progress').innerText = Math.floor(percent)+"%";
  dailyChart.data.labels = days;
  dailyChart.data.datasets[0].data = amounts;
  dailyChart.update();
}
</script>
<script>
// ============== CONFIG PIN ==============
const ADMIN_PIN = '1234'; // <-- CAMBIALO tu! Esempio: '5791'

// ============== SELETTORE UI (adegua agli ID gi√† presenti) ==============
const btnImposta = document.getElementById('saveGoalBtn');
const btnAggiungi = document.getElementById('addBtn');
const btnReset = document.getElementById('resetBtn');
const rowsTable = document.getElementById('rows'); // tabella righe, se esiste

// stato admin persistente (locale al device)
let isAdmin = localStorage.getItem('barapp:isAdmin') === 'true';

// abilita/disabilita azioni di scrittura
function setReadOnlyUI(readOnly) {
  const targets = [btnImposta, btnAggiungi, btnReset];
  targets.forEach(el=>{
    if(!el) return;
    el.disabled = readOnly;
    el.style.opacity = readOnly ? 0.5 : 1;
    el.style.pointerEvents = readOnly ? 'none' : 'auto';
  });

  // disabilita bottoni "Elimina" in tabella
  if (rowsTable) {
    rowsTable.querySelectorAll('button').forEach(b=>{
      b.disabled = readOnly;
      b.style.opacity = readOnly ? 0.5 : 1;
      b.style.pointerEvents = readOnly ? 'none' : 'auto';
    });
  }

  statusSpan.textContent = readOnly ? 'sola lettura' : 'ADMIN';
  statusSpan.style.background = readOnly ? '#eee' : '#ffe3cc';
}

// barra admin (login/logout + stato)
const adminBar = document.createElement('div');
adminBar.style.display = 'flex';
adminBar.style.justifyContent = 'center';
adminBar.style.margin = '12px 0';

const adminBtn = document.createElement('button');
adminBtn.className = 'admin-btn';
adminBtn.textContent = isAdmin ? 'üîì Esci da Admin' : 'üîê Login Admin';

const statusSpan = document.createElement('span');
statusSpan.className = 'admin-badge';
statusSpan.textContent = isAdmin ? 'ADMIN' : 'sola lettura';

adminBar.appendChild(adminBtn);
adminBar.appendChild(statusSpan);
document.body.appendChild(adminBar);

// login/logout
adminBtn.onclick = ()=>{
  if (isAdmin) {
    isAdmin = false;
    localStorage.setItem('barapp:isAdmin','false');
    adminBtn.textContent = 'üîê Login Admin';
    setReadOnlyUI(true);
    alert('Sei uscito dalla modalit√† Admin.');
  } else {
    const pin = prompt('Inserisci PIN admin:');
    if (pin === ADMIN_PIN) {
      isAdmin = true;
      localStorage.setItem('barapp:isAdmin','true');
      adminBtn.textContent = 'üîì Esci da Admin';
      setReadOnlyUI(false);
      alert('Accesso Admin riuscito.');
    } else if (pin !== null) {
      alert('PIN errato.');
    }
  }
};

// stato iniziale: sola lettura se non admin
setReadOnlyUI(!isAdmin);
</script>
</body>
</html>
